# Playwright BDD Automation Framework

## Project Structure

```
playwright-bdd-framework/
├── src/
│   ├── pages/
│   │   ├── BasePage.ts
│   │   ├── LoginPage.ts
│   │   └── DashboardPage.ts
│   ├── steps/
│   │   ├── loginSteps.ts
│   │   └── dashboardSteps.ts
│   ├── hooks/
│   │   └── hooks.ts
│   ├── utils/
│   │   ├── logger.ts
│   │   ├── screenshot.ts
│   │   └── config.ts
│   └── support/
│       └── world.ts
├── features/
│   ├── login.feature
│   └── dashboard.feature
├── test-data/
│   ├── dev.json
│   └── prod.json
├── reports/
├── screenshots/
├── package.json
├── tsconfig.json
├── cucumber.js
└── playwright.config.ts
```

## Installation

```bash
npm init -y
npm install --save-dev @playwright/test playwright
npm install --save-dev @cucumber/cucumber @cucumber/cucumber-expressions
npm install --save-dev ts-node typescript @types/node
npm install --save-dev winston dotenv
```

## Configuration Files

### package.json

```json
{
  "name": "playwright-bdd-framework",
  "version": "1.0.0",
  "scripts": {
    "test": "cucumber-js",
    "test:chrome": "cucumber-js --profile chrome",
    "test:firefox": "cucumber-js --profile firefox",
    "test:headed": "cucumber-js --profile headed",
    "test:tag": "cucumber-js --tags",
    "report": "node src/utils/reporter.js"
  },
  "devDependencies": {
    "@cucumber/cucumber": "^10.0.0",
    "@playwright/test": "^1.40.0",
    "@types/node": "^20.0.0",
    "dotenv": "^16.0.0",
    "ts-node": "^10.0.0",
    "typescript": "^5.0.0",
    "winston": "^3.11.0"
  }
}
```

### tsconfig.json

```json
{
  "compilerOptions": {
    "target": "ES2020",
    "module": "commonjs",
    "lib": ["ES2020"],
    "outDir": "./dist",
    "rootDir": "./src",
    "strict": true,
    "esModuleInterop": true,
    "skipLibCheck": true,
    "forceConsistentCasingInFileNames": true,
    "resolveJsonModule": true,
    "moduleResolution": "node",
    "types": ["node", "@cucumber/cucumber"]
  },
  "include": ["src/**/*", "features/**/*"],
  "exclude": ["node_modules"]
}
```

### cucumber.js

```javascript
const common = {
  requireModule: ['ts-node/register'],
  require: ['src/steps/**/*.ts', 'src/hooks/**/*.ts'],
  format: [
    'progress-bar',
    'html:reports/cucumber-report.html',
    'json:reports/cucumber-report.json',
    'junit:reports/cucumber-report.xml'
  ],
  formatOptions: {
    snippetInterface: 'async-await'
  }
};

module.exports = {
  default: {
    ...common,
    parallel: 2
  },
  chrome: {
    ...common,
    worldParameters: {
      browser: 'chromium'
    }
  },
  firefox: {
    ...common,
    worldParameters: {
      browser: 'firefox'
    }
  },
  headed: {
    ...common,
    worldParameters: {
      headless: false
    }
  }
};
```

### playwright.config.ts

```typescript
import { PlaywrightTestConfig } from '@playwright/test';

const config: PlaywrightTestConfig = {
  testDir: './features',
  timeout: 60000,
  retries: 1,
  use: {
    headless: true,
    viewport: { width: 1280, height: 720 },
    actionTimeout: 15000,
    navigationTimeout: 30000,
    screenshot: 'only-on-failure',
    video: 'retain-on-failure',
    trace: 'retain-on-failure'
  },
  projects: [
    { name: 'chromium', use: { browserName: 'chromium' } },
    { name: 'firefox', use: { browserName: 'firefox' } },
    { name: 'webkit', use: { browserName: 'webkit' } }
  ]
};

export default config;
```

## Core Files

### src/support/world.ts

```typescript
import { Browser, BrowserContext, Page, chromium, firefox, webkit } from '@playwright/test';
import { IWorldOptions, World, setWorldConstructor } from '@cucumber/cucumber';
import { Logger } from '../utils/logger';

export class CustomWorld extends World {
  browser!: Browser;
  context!: BrowserContext;
  page!: Page;
  logger: Logger;

  constructor(options: IWorldOptions) {
    super(options);
    this.logger = new Logger();
  }

  async init(browserName: string = 'chromium', headless: boolean = true) {
    switch (browserName) {
      case 'firefox':
        this.browser = await firefox.launch({ headless });
        break;
      case 'webkit':
        this.browser = await webkit.launch({ headless });
        break;
      default:
        this.browser = await chromium.launch({ headless });
    }
    
    this.context = await this.browser.newContext({
      viewport: { width: 1280, height: 720 },
      recordVideo: { dir: 'reports/videos/' }
    });
    
    this.page = await this.context.newPage();
  }

  async cleanup() {
    if (this.page) await this.page.close();
    if (this.context) await this.context.close();
    if (this.browser) await this.browser.close();
  }
}

setWorldConstructor(CustomWorld);
```

### src/hooks/hooks.ts

```typescript
import { Before, After, BeforeAll, AfterAll, Status } from '@cucumber/cucumber';
import { CustomWorld } from '../support/world';
import { captureScreenshot } from '../utils/screenshot';

BeforeAll(async function() {
  console.log('Test Suite Started');
});

Before(async function(this: CustomWorld, { pickle }) {
  const browserName = this.parameters.browser || 'chromium';
  const headless = this.parameters.headless !== false;
  
  await this.init(browserName, headless);
  this.logger.info(`Starting scenario: ${pickle.name}`);
});

After(async function(this: CustomWorld, { pickle, result }) {
  if (result?.status === Status.FAILED) {
    const screenshot = await captureScreenshot(this.page, pickle.name);
    this.attach(screenshot, 'image/png');
    this.logger.error(`Scenario failed: ${pickle.name}`);
  }
  
  await this.cleanup();
  this.logger.info(`Completed scenario: ${pickle.name}`);
});

AfterAll(async function() {
  console.log('Test Suite Completed');
});
```

### src/pages/BasePage.ts

```typescript
import { Page, Locator } from '@playwright/test';
import { Logger } from '../utils/logger';

export class BasePage {
  protected page: Page;
  protected logger: Logger;

  constructor(page: Page) {
    this.page = page;
    this.logger = new Logger();
  }

  async navigate(url: string): Promise<void> {
    await this.page.goto(url);
    this.logger.info(`Navigated to: ${url}`);
  }

  async click(selector: string): Promise<void> {
    await this.page.click(selector);
    this.logger.info(`Clicked on: ${selector}`);
  }

  async fill(selector: string, text: string): Promise<void> {
    await this.page.fill(selector, text);
    this.logger.info(`Filled ${selector} with: ${text}`);
  }

  async getText(selector: string): Promise<string> {
    const text = await this.page.textContent(selector);
    return text || '';
  }

  async waitForSelector(selector: string, timeout: number = 10000): Promise<Locator> {
    return await this.page.waitForSelector(selector, { timeout });
  }

  async isVisible(selector: string): Promise<boolean> {
    return await this.page.isVisible(selector);
  }

  async selectOption(selector: string, value: string): Promise<void> {
    await this.page.selectOption(selector, value);
    this.logger.info(`Selected ${value} from ${selector}`);
  }

  async getPageTitle(): Promise<string> {
    return await this.page.title();
  }

  async getPageUrl(): Promise<string> {
    return this.page.url();
  }
}
```

### src/pages/LoginPage.ts

```typescript
import { Page } from '@playwright/test';
import { BasePage } from './BasePage';

export class LoginPage extends BasePage {
  private selectors = {
    usernameInput: '#username',
    passwordInput: '#password',
    loginButton: '#login-button',
    errorMessage: '.error-message'
  };

  constructor(page: Page) {
    super(page);
  }

  async enterUsername(username: string): Promise<void> {
    await this.fill(this.selectors.usernameInput, username);
  }

  async enterPassword(password: string): Promise<void> {
    await this.fill(this.selectors.passwordInput, password);
  }

  async clickLoginButton(): Promise<void> {
    await this.click(this.selectors.loginButton);
  }

  async login(username: string, password: string): Promise<void> {
    await this.enterUsername(username);
    await this.enterPassword(password);
    await this.clickLoginButton();
    this.logger.info(`Login attempted with username: ${username}`);
  }

  async getErrorMessage(): Promise<string> {
    return await this.getText(this.selectors.errorMessage);
  }

  async isErrorDisplayed(): Promise<boolean> {
    return await this.isVisible(this.selectors.errorMessage);
  }
}
```

### src/pages/DashboardPage.ts

```typescript
import { Page } from '@playwright/test';
import { BasePage } from './BasePage';

export class DashboardPage extends BasePage {
  private selectors = {
    welcomeMessage: '.welcome-message',
    userMenu: '#user-menu',
    logoutButton: '#logout'
  };

  constructor(page: Page) {
    super(page);
  }

  async getWelcomeMessage(): Promise<string> {
    return await this.getText(this.selectors.welcomeMessage);
  }

  async isWelcomeMessageVisible(): Promise<boolean> {
    return await this.isVisible(this.selectors.welcomeMessage);
  }

  async logout(): Promise<void> {
    await this.click(this.selectors.userMenu);
    await this.click(this.selectors.logoutButton);
    this.logger.info('User logged out');
  }
}
```

### src/steps/loginSteps.ts

```typescript
import { Given, When, Then } from '@cucumber/cucumber';
import { expect } from '@playwright/test';
import { CustomWorld } from '../support/world';
import { LoginPage } from '../pages/LoginPage';
import { DashboardPage } from '../pages/DashboardPage';

Given('I am on the login page', async function(this: CustomWorld) {
  await this.page.goto('https://example.com/login');
});

When('I enter username {string}', async function(this: CustomWorld, username: string) {
  const loginPage = new LoginPage(this.page);
  await loginPage.enterUsername(username);
});

When('I enter password {string}', async function(this: CustomWorld, password: string) {
  const loginPage = new LoginPage(this.page);
  await loginPage.enterPassword(password);
});

When('I click the login button', async function(this: CustomWorld) {
  const loginPage = new LoginPage(this.page);
  await loginPage.clickLoginButton();
});

When('I login with username {string} and password {string}', async function(
  this: CustomWorld, 
  username: string, 
  password: string
) {
  const loginPage = new LoginPage(this.page);
  await loginPage.login(username, password);
});

Then('I should see the dashboard', async function(this: CustomWorld) {
  const dashboardPage = new DashboardPage(this.page);
  const isVisible = await dashboardPage.isWelcomeMessageVisible();
  expect(isVisible).toBeTruthy();
});

Then('I should see error message {string}', async function(this: CustomWorld, expectedMessage: string) {
  const loginPage = new LoginPage(this.page);
  const actualMessage = await loginPage.getErrorMessage();
  expect(actualMessage).toContain(expectedMessage);
});
```

### src/steps/dashboardSteps.ts

```typescript
import { Given, When, Then } from '@cucumber/cucumber';
import { expect } from '@playwright/test';
import { CustomWorld } from '../support/world';
import { DashboardPage } from '../pages/DashboardPage';

Given('I am logged in to the application', async function(this: CustomWorld) {
  // Perform login steps
  await this.page.goto('https://example.com/login');
  // Add login logic
});

Then('I should see welcome message containing {string}', async function(
  this: CustomWorld, 
  expectedText: string
) {
  const dashboardPage = new DashboardPage(this.page);
  const message = await dashboardPage.getWelcomeMessage();
  expect(message).toContain(expectedText);
});

When('I logout from the application', async function(this: CustomWorld) {
  const dashboardPage = new DashboardPage(this.page);
  await dashboardPage.logout();
});
```

### src/utils/logger.ts

```typescript
import winston from 'winston';

export class Logger {
  private logger: winston.Logger;

  constructor() {
    this.logger = winston.createLogger({
      level: 'info',
      format: winston.format.combine(
        winston.format.timestamp({ format: 'YYYY-MM-DD HH:mm:ss' }),
        winston.format.printf(({ timestamp, level, message }) => {
          return `${timestamp} [${level.toUpperCase()}]: ${message}`;
        })
      ),
      transports: [
        new winston.transports.Console(),
        new winston.transports.File({ filename: 'reports/test-execution.log' })
      ]
    });
  }

  info(message: string): void {
    this.logger.info(message);
  }

  error(message: string): void {
    this.logger.error(message);
  }

  warn(message: string): void {
    this.logger.warn(message);
  }

  debug(message: string): void {
    this.logger.debug(message);
  }
}
```

### src/utils/screenshot.ts

```typescript
import { Page } from '@playwright/test';
import * as fs from 'fs';
import * as path from 'path';

export async function captureScreenshot(page: Page, scenarioName: string): Promise<Buffer> {
  const screenshotDir = path.join(process.cwd(), 'screenshots');
  
  if (!fs.existsSync(screenshotDir)) {
    fs.mkdirSync(screenshotDir, { recursive: true });
  }

  const timestamp = new Date().toISOString().replace(/[:.]/g, '-');
  const fileName = `${scenarioName.replace(/\s+/g, '_')}_${timestamp}.png`;
  const filePath = path.join(screenshotDir, fileName);

  const screenshot = await page.screenshot({ path: filePath, fullPage: true });
  return screenshot;
}
```

### src/utils/config.ts

```typescript
import * as dotenv from 'dotenv';

dotenv.config();

export const config = {
  baseUrl: process.env.BASE_URL || 'https://example.com',
  browser: process.env.BROWSER || 'chromium',
  headless: process.env.HEADLESS !== 'false',
  timeout: parseInt(process.env.TIMEOUT || '30000'),
  retries: parseInt(process.env.RETRIES || '1'),
  parallel: parseInt(process.env.PARALLEL || '2')
};
```

## Feature Files

### features/login.feature

```gherkin
@login @regression
Feature: Login Functionality
  As a user
  I want to login to the application
  So that I can access my account

  Background:
    Given I am on the login page

  @smoke @positive
  Scenario: Successful login with valid credentials
    When I login with username "validuser" and password "validpass"
    Then I should see the dashboard

  @negative
  Scenario: Login with invalid credentials
    When I login with username "invaliduser" and password "wrongpass"
    Then I should see error message "Invalid credentials"

  @negative
  Scenario Outline: Login with different invalid credentials
    When I enter username "<username>"
    And I enter password "<password>"
    And I click the login button
    Then I should see error message "<error>"

    Examples:
      | username | password | error                |
      | admin    | wrong    | Invalid credentials  |
      |          | pass123  | Username is required |
      | user123  |          | Password is required |
```

### features/dashboard.feature

```gherkin
@dashboard @regression
Feature: Dashboard Functionality
  As a logged in user
  I want to view my dashboard
  So that I can access application features

  Background:
    Given I am logged in to the application

  @smoke
  Scenario: View dashboard after login
    Then I should see welcome message containing "Welcome"

  @logout
  Scenario: Logout from dashboard
    When I logout from the application
    Then I should see the login page
```

## Test Data

### test-data/dev.json

```json
{
  "users": {
    "admin": {
      "username": "admin@example.com",
      "password": "Admin@123"
    },
    "user": {
      "username": "user@example.com",
      "password": "User@123"
    }
  },
  "urls": {
    "baseUrl": "https://dev.example.com",
    "loginUrl": "https://dev.example.com/login"
  }
}
```

## .env

```
BASE_URL=https://example.com
BROWSER=chromium
HEADLESS=true
TIMEOUT=30000
RETRIES=1
PARALLEL=2
ENV=dev
```

## Run Commands

```bash
# Run all tests
npm test

# Run with specific browser
npm run test:chrome
npm run test:firefox

# Run in headed mode
npm run test:headed

# Run specific tags
npm run test:tag @smoke
npm run test:tag "@login and @positive"

# Run specific feature
npx cucumber-js features/login.feature

# Generate reports
npm run report
```

## Key Features

1. **Page Object Model (POM)** - Organized, maintainable page classes
2. **BDD with Cucumber** - Gherkin syntax for readable scenarios
3. **Playwright Integration** - Modern, fast browser automation
4. **Custom World** - Shared context across steps
5. **Hooks** - Before/After setup and cleanup
6. **Logging** - Winston logger for test execution
7. **Screenshots** - Auto-capture on failure
8. **Parallel Execution** - Run tests concurrently
9. **Multiple Browsers** - Chrome, Firefox, WebKit support
10. **Reporting** - HTML, JSON, JUnit reports
11. **TypeScript** - Type safety and better IDE support
12. **Configuration Management** - Environment-based configs
13. **Reusable Steps** - DRY principle implementation

This framework is production-ready and follows industry best practices!
```
